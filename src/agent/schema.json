{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://example.com/schemas/visualization-data-server.schema.json",
    "title": "VisualizationDataServerResponse",
    "type": "object",
    "additionalProperties": true,
    "required": ["success", "data"],
    "properties": {
      "success": { "type": "boolean" },
      "data": { "$ref": "#/$defs/VisualizationDataServerEnvelope" }
    },
    "$defs": {
      "VisualizationDataServerEnvelope": {
        "type": "object",
        "additionalProperties": true,
        "required": ["title", "type", "extras", "payload", "helpers"],
        "properties": {
          "title": { "type": "string" },
          "type": { "type": "string" },
          "extras": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "additionalProperties": { "$ref": "#/$defs/UpdatedMistTrackInfo" }
            }
          },
          "payload": { "$ref": "#/$defs/ViewData" },
          "helpers": { "$ref": "#/$defs/ViewDataHelpers" },

          "createdAt": { "type": "number" },
          "updatedAt": { "type": "number" },
          "isFiatMode": { "type": "boolean" }
        }
      },

      "ViewData": {
        "type": "object",
        "additionalProperties": true,
        "required": ["comments", "connects", "items", "transform", "txs"],
        "properties": {
          "comments": {
            "type": "array",
            "items": { "$ref": "#/$defs/CommentView" }
          },
          "connects": {
            "type": "array",
            "items": {
              "oneOf": [
                { "$ref": "#/$defs/ConnectView" },
                { "$ref": "#/$defs/MergedConnectView" },
                { "$ref": "#/$defs/SimpleConnectView" }
              ]
            }
          },
          "items": {
            "type": "array",
            "items": {
              "oneOf": [
                { "$ref": "#/$defs/ItemAddress" },
                { "$ref": "#/$defs/ItemEntity" },
                { "$ref": "#/$defs/CustomClusterItem" }
              ]
            }
          },
          "transform": { "$ref": "#/$defs/Transform" },
          "txs": {
            "type": "array",
            "items": {
              "oneOf": [
                { "$ref": "#/$defs/TxView" },
                { "$ref": "#/$defs/MergedTxItem" }
              ]
            }
          }
        }
      },

      "XYPosition": {
        "type": "object",
        "additionalProperties": true,
        "required": ["x", "y"],
        "properties": {
          "x": { "type": "number" },
          "y": { "type": "number" }
        }
      },

      "Transform": {
        "type": "object",
        "additionalProperties": true,
        "required": ["k", "x", "y"],
        "properties": {
          "k": { "type": "number" },
          "x": { "type": "number" },
          "y": { "type": "number" }
        }
      },

      "NodeType": {
        "description": "Kept flexible because your TS enum values are not fully provided.",
        "type": "string",
        "minLength": 1
      },

      "CommentView": {
        "type": "object",
        "additionalProperties": true,
        "required": ["descriptor", "type", "text", "x", "y", "isManuallyMoved"],
        "properties": {
          "author": { "type": "string" },
          "date": { "type": "number" },
          "descriptor": { "type": "string" },

          "type": { "const": "comment" },
          "typeOfComment": { "type": "string" },

          "text": { "type": "string" },
          "color": { "type": "string" },
          "width": { "type": "number" },
          "height": { "type": "number" },

          "x": { "type": "number" },
          "y": { "type": "number" },
          "isManuallyMoved": { "type": "boolean" }
        }
      },

      "ConnectView": {
        "type": "object",
        "additionalProperties": true,
        "required": ["source", "target", "data"],
        "properties": {
          "source": { "type": "string" },
          "target": { "type": "string" },
          "data": {
            "type": "object",
            "additionalProperties": true,
            "required": ["currency", "amount", "token_id", "fiatRate", "isNeedReverse", "isNew"],
            "properties": {
              "currency": { "type": "string" },
              "amount": { "type": ["number", "null"] },
              "token_id": { "type": "number" },
              "fiatRate": { "type": "number" },
              "isNeedReverse": { "type": "boolean" },
              "isNew": { "type": "boolean" },
              "color": { "type": "string" },
              "hovered": { "type": "boolean" }
            }
          }
        }
      },

      "MergedConnectView": {
        "type": "object",
        "additionalProperties": true,
        "required": ["id", "type", "source", "target", "data"],
        "properties": {
          "id": { "type": "string" },
          "type": { "const": "mergedEdge" },
          "source": { "type": "string" },
          "target": { "type": "string" },
          "data": {
            "type": "object",
            "additionalProperties": true,
            "required": ["input", "output"],
            "properties": {
              "input": { "type": ["string", "number"] },
              "output": { "type": ["string", "number"] },
              "color": { "type": "string" }
            }
          }
        }
      },

      "SimpleConnectView": {
        "type": "object",
        "additionalProperties": true,
        "required": ["source", "target", "data"],
        "properties": {
          "source": { "type": "string" },
          "target": { "type": "string" },
          "data": {
            "type": "object",
            "additionalProperties": true,
            "required": ["color", "type"],
            "properties": {
              "color": { "type": "string" },
              "type": { "type": "string" },
              "hovered": { "type": "boolean" }
            }
          }
        }
      },

      "ItemBase": {
        "allOf": [
          { "$ref": "#/$defs/XYPosition" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["descriptor", "extend", "isManuallyMoved", "type"],
            "properties": {
              "descriptor": { "type": "string" },
              "entry": { "type": "string" },
              "label": { "type": "string" },

              "parentId": { "type": "string" },
              "parent": { "type": ["string", "null"] },

              "extent": { "type": ["string", "object"] },
              "isManuallyMoved": { "type": "boolean" },

              "type": { "type": "string" },

              "extend": { "$ref": "#/$defs/Extend" }
            }
          }
        ]
      },

      "PublicInfo": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "twitter": { "type": "array", "items": { "type": "string" } },
          "ens": { "type": "array", "items": { "type": "string" } }
        }
      },

      "ItemAddress": {
        "allOf": [
          { "$ref": "#/$defs/ItemBase" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["address"],
            "properties": {
              "address": { "type": "string" },
              "publicInfo": { "$ref": "#/$defs/PublicInfo" }
            }
          }
        ]
      },

      "ItemEntity": {
        "allOf": [
          { "$ref": "#/$defs/ItemBase" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["address"],
            "properties": {
              "address": { "type": "number" }
            }
          }
        ]
      },

      "CustomClusterItem": {
        "description": "Not fully specified in your types; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "Extend": {
        "description": "Union of AddressExtend | EntityExtend etc. Not fully specified; validate common fields seen in example.",
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "currency": { "type": "string" },
          "token_id": { "type": "number" },
          "riskScore": { "type": "number" },
          "type": { "type": "string" },
          "owner": { "$ref": "#/$defs/Owner" }
        }
      },

      "TxView": {
        "allOf": [
          { "$ref": "#/$defs/XYPosition" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["currency", "descriptor", "hash", "token_id", "type", "path"],
            "properties": {
              "currency": { "type": "string" },
              "descriptor": { "type": "string" },
              "hash": { "type": "string" },
              "token_id": { "type": "number" },
              "type": { "$ref": "#/$defs/NodeType" },
              "color": { "type": "string" },
              "mergedList": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": true,
                  "required": ["input", "output"],
                  "properties": {
                    "input": { "type": ["string", "number"] },
                    "output": { "type": ["string", "number"] }
                  }
                }
              },
              "parentNode": { "type": "string" },
              "path": { "type": ["string", "null"] }
            }
          }
        ]
      },

      "MergedTxItem": {
        "type": "object",
        "additionalProperties": true,
        "required": ["descriptor", "hash", "input", "output", "type"],
        "properties": {
          "descriptor": { "type": "string" },
          "hash": { "type": "string" },
          "input": { "type": ["string", "number"] },
          "output": { "type": ["string", "number"] },
          "x": { "type": "number" },
          "y": { "type": "number" },
          "type": { "const": "mergedTx" }
        }
      },

      "ViewDataHelpers": {
        "type": "object",
        "additionalProperties": true,
        "required": ["isConnectionBasedMode", "interactionTxsStatsList", "isFiatMode", "isMergedTxMode", "blockList", "labels", "txList", "currencyInfo"],
        "properties": {
          "isConnectionBasedMode": { "type": "boolean" },
          "interactionTxsStatsList": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "additionalProperties": {
                "type": "array",
                "items": { "$ref": "#/$defs/TxsInteractionStats" }
              }
            }
          },
          "isFiatMode": { "type": "boolean" },
          "isMergedTxMode": { "type": "boolean" },
          "isHelperLinesDisabled": { "type": "boolean" },
          "prevReportAddressData": {
            "oneOf": [
              { "type": "null" },
              { "$ref": "#/$defs/RepotAddressModalDataForSave" }
            ]
          },
          "labels": {
            "type": "array",
            "items": { "$ref": "#/$defs/Label" }
          },
          "txList": {
            "type": "array",
            "items": { "$ref": "#/$defs/SavedTransactionList" }
          },
          "currencyInfo": {
            "type": "array",
            "items": { "$ref": "#/$defs/Token" }
          },
          "autoTxs": {
            "type": "array",
            "items": { "$ref": "#/$defs/AutoTxsListVisualization" }
          },
          "blockList": {
            "type": "array",
            "items": { "$ref": "#/$defs/BlockList" }
          },
          "commentSettings": { "$ref": "#/$defs/CommentSettings" }
        }
      },

      "SavedTransactionList": {
        "allOf": [
          { "$ref": "#/$defs/TransactionList" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["inputs", "outputs"],
            "properties": {
              "inputs": { "type": "array", "items": { "$ref": "#/$defs/SavedAddressEntity" } },
              "outputs": { "type": "array", "items": { "$ref": "#/$defs/SavedAddressEntity" } }
            }
          }
        ]
      },

      "TransactionList": {
        "type": "object",
        "additionalProperties": true,
        "required": [
          "inputs",
          "outputs",
          "hash",
          "addressesCount",
          "amount",
          "fiatRate",
          "fee",
          "currency",
          "tokenId",
          "path",
          "date",
          "poolTime",
          "type"
        ],
        "properties": {
          "inputs": { "type": "array", "items": { "$ref": "#/$defs/ProcessedAddressEntity" } },
          "outputs": { "type": "array", "items": { "$ref": "#/$defs/ProcessedAddressEntity" } },

          "hash": { "type": "string" },
          "addressesCount": { "type": "number" },
          "amount": { "type": "number" },
          "fiatRate": { "type": "number" },
          "fee": { "type": "number" },
          "currency": { "type": "string" },
          "tokenId": { "type": "number" },
          "path": { "type": ["string", "null"] },
          "date": { "type": "number" },
          "poolTime": { "type": "number" },
          "type": { "$ref": "#/$defs/NodeType" }
        }
      },

      "ProcessedAddressEntity": {
        "allOf": [
          { "$ref": "#/$defs/BaseAddressEntity" },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["amount"],
            "properties": {
              "addresses": {
                "description": "In TS it is Set<string>; in JSON it should serialize to an array of strings.",
                "type": "array",
                "items": { "type": "string" }
              },
              "amount": { "type": "number" },
              "next": { "type": "string" },
              "pos": { "type": "number" },
              "count": { "type": "number" }
            }
          }
        ]
      },

      "SavedAddressEntity": {
        "allOf": [
          {
            "oneOf": [
              { "$ref": "#/$defs/BaseAddressEntity" },
              { "$ref": "#/$defs/BaseAddressEntityBTC" }
            ]
          },
          {
            "type": "object",
            "additionalProperties": true,
            "required": ["amount"],
            "properties": {
              "addresses": { "type": "array", "items": { "type": "string" } },
              "amount": { "type": "number" },
              "next": { "type": "string" },
              "pos": { "type": "number" },
              "count": { "type": "number" }
            }
          }
        ]
      },

      "BaseAddressEntity": {
        "type": "object",
        "additionalProperties": true,
        "required": ["address", "riskscore"],
        "properties": {
          "address": { "type": "string" },
          "riskscore": { "type": "number" },
          "type": { "type": "string" },
          "owner": { "$ref": "#/$defs/Owner" }
        }
      },

      "BaseAddressEntityBTC": {
        "allOf": [
          { "$ref": "#/$defs/BaseAddressEntity" },
          {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "pos": { "type": "number" },
              "amount": { "type": "number" }
            }
          }
        ]
      },

      "Owner": {
        "type": "object",
        "additionalProperties": true,
        "required": ["id"],
        "properties": {
          "global_id": { "type": "number" },
          "first_activity": { "type": "number" },
          "id": { "type": "number" },
          "name": { "type": "string" },
          "last_activity": { "type": "number" },
          "size": { "type": "number" },
          "status": { "type": "string" },
          "slug": { "type": "string" },
          "subtype": { "type": ["string", "null"] },
          "type": { "type": "string" }
        }
      },

      "Token": {
        "type": "object",
        "additionalProperties": true,
        "required": ["currency", "token_id", "name", "symbol", "unit"],
        "properties": {
          "currency": { "type": "string" },
          "issuer": { "type": ["string", "null"] },
          "name": { "type": "string" },
          "symbol": { "type": "string" },
          "token_id": { "type": "number" },
          "unit": { "type": "number" }
        }
      },

      "TxsInteractionStats": {
        "description": "Not provided; kept permissive to avoid schema false-positives.",
        "type": "object",
        "additionalProperties": true
      },

      "RepotAddressModalDataForSave": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "Label": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "AutoTxsListVisualization": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "BlockList": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "CommentSettings": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      },

      "UpdatedMistTrackInfo": {
        "description": "Not provided; kept permissive.",
        "type": "object",
        "additionalProperties": true
      }
    }
  }